<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–í–∏–¥–µ–æ | Mortis Play</title>
  <meta name="description" content="–í—Å–µ —Å—Ç—Ä–∏–º—ã, –±–ª–∏—Ü—ã, –º–µ–º—ã –∏ –ø–æ–¥–∫–∞—Å—Ç—ã –æ—Ç Mortis Play. Rutube + YouTube —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º." />
  
  <!-- FONT AWESOME -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <!-- FAVICON (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
  <link rel="icon" href="../favicon.ico" type="image/x-icon">

  <!-- –í–°–¢–†–û–ï–ù–ù–´–ô CSS ‚Äî –í–ï–°–¨ –î–ò–ó–ê–ô–ù –ó–î–ï–°–¨ -->
  <style>
    /* === –û–°–ù–û–í–ù–´–ï –¶–í–ï–¢–ê –ò –®–†–ò–§–¢–´ === */
    :root {
      --bg: #0f0f1a;
      --card-bg: rgba(30, 30, 60, 0.6);
      --neon-purple: #a855f7;
      --neon-cyan: #22d3ee;
      --text: #e2e8f0;
      --text-light: #94a3b8;
      --glass: rgba(255, 255, 255, 0.05);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      line-height: 1.6;
    }

    /* === –ù–ê–í–ò–ì–ê–¶–ò–Ø === */
    .glass-nav {
      background: rgba(15, 15, 26, 0.7);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(168, 85, 247, 0.2);
    }

    .neon-title {
      background: linear-gradient(90deg, var(--neon-purple), var(--neon-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
    }

    /* === –ö–ù–û–ü–ö–ò === */
    .neon-btn {
      background: linear-gradient(45deg, transparent, rgba(168, 85, 247, 0.1));
      border: 1.5px solid var(--neon-purple);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      font-size: 1rem;
    }

    .neon-btn:hover {
      background: rgba(168, 85, 247, 0.2);
      box-shadow: 0 0 20px rgba(168, 85, 247, 0.4);
      transform: translateY(-2px);
    }

    .neon-btn.active {
      background: var(--neon-purple);
      box-shadow: 0 0 15px rgba(168, 85, 247, 0.6);
    }

    /* === –°–¢–ï–ö–õ–Ø–ù–ù–´–ï –ö–ê–†–¢–û–ß–ö–ò === */
    .glass-card {
      background: var(--glass);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 16px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    /* === –°–ï–¢–ö–ê –í–ò–î–ï–û === */
    #videosGrid {
      display: grid;
      gap: 1.5rem;
    }

    @media (min-width: 640px) { #videosGrid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1024px) { #videosGrid { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 1280px) { #videosGrid { grid-template-columns: repeat(4, 1fr); } }

    .video-card {
      transition: all 0.5s ease;
    }

    .video-card iframe {
      border: none;
      border-radius: 12px;
    }

    /* === –ê–ù–ò–ú–ê–¶–ò–ò === */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .animate-spin { animation: spin 1s linear infinite; }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .animate-pulse { animation: pulse 2s infinite; }

    /* === –£–¢–ò–õ–ò–¢–´ === */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .aspect-video {
      aspect-ratio: 16 / 9;
    }

    .text-center { text-align: center; }
    .mt-3 { margin-top: 0.75rem; }
    .mt-6 { margin-top: 1.5rem; }
    .mt-8 { margin-top: 2rem; }
    .mt-10 { margin-top: 2.5rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .py-10 { padding: 2.5rem 0; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .justify-center { justify-content: center; }
    .items-center { align-items: center; }
    .space-x-4 > * + * { margin-left: 1rem; }
    .rounded-xl { border-radius: 0.75rem; }
    .rounded-lg { border-radius: 0.5rem; }
    .font-medium { font-weight: 500; }
    .text-sm { font-size: 0.875rem; }
    .text-4xl { font-size: 2.25rem; }
    .text-6xl { font-size: 3.75rem; }
    @media (min-width: 768px) {
      .md\:text-6xl { font-size: 3.75rem; }
    }
  </style>
</head>
<body>

  <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
  <nav class="glass-nav fixed top-0 w-full z-50">
    <div class="mx-auto max-w-7xl px-4 flex justify-between items-center py-4">
      <a href="/" class="neon-title text-2xl font-bold">Mortis Play</a>
      <a href="/" class="neon-btn text-sm px-4 py-2">
        <i class="fa-solid fa-home"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
      </a>
    </div>
  </nav>

  <!-- –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ù–¢ -->
  <main class="pt-24 pb-16">
    <section id="videos" class="mx-auto max-w-7xl px-4">
      <h1 class="neon-title text-4xl md:text-6xl font-bold text-center mb-8">–ú–æ–∏ –≤–∏–¥–µ–æ</h1>

      <!-- –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ -->
      <div class="flex justify-center mb-6">
        <div class="glass-card p-4 flex items-center gap-4 rounded-xl">
          <span class="text-gray-300 font-medium">–°–º–æ—Ç—Ä–∏ –Ω–∞:</span>
          <select id="platformSwitch" class="neon-btn bg-transparent border-purple-500 text-white px-4 py-2 rounded-lg">
            <option value="rutube">Rutube</option>
            <option value="youtube">YouTube</option>
          </select>
          <i class="fa-solid fa-sync-alt text-purple-400 animate-spin hidden" id="switchLoader"></i>
        </div>
      </div>

      <!-- –§–ò–õ–¨–¢–†–´ -->
      <div class="mt-6 flex justify-center gap-3 flex-wrap">
        <button class="neon-btn video-filter active" data-filter="all">–í—Å–µ</button>
        <button class="neon-btn video-filter" data-filter="streams">–°—Ç—Ä–∏–º—ã</button>
        <button class="neon-btn video-filter" data-filter="fun">–£–≥–∞—Ä</button>
        <button class="neon-btn video-filter" data-filter="blitz">–ë–õ–ò–¶ Play</button>
      </div>

      <p class="mt-3 text-center text-sm text-gray-300 italic">
        –í—Å–µ –≤–∏–¥–µ–æ –æ—Ç Mortis Play: —Å—Ç—Ä–∏–º—ã, –º–µ–º—ã, –±–ª–∏—Ü—ã –∏ –ø–æ–¥–∫–∞—Å—Ç—ã!
      </p>

      <!-- –°–ï–¢–ö–ê –í–ò–î–ï–û -->
      <div id="videosGrid" class="mt-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <!-- JS –≤—Å—Ç–∞–≤–∏—Ç –≤–∏–¥–µ–æ -->
      </div>

      <!-- –ö–ù–û–ü–ö–ò -->
      <div class="mt-10 text-center space-x-4">
        <button id="loadMoreVideos" class="neon-btn px-6 py-3">
          <i class="fa-solid fa-plus"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë
        </button>
        <a id="allVideosLink" href="#" target="_blank" class="neon-btn">
          <i class="fa-brands fa-rutube"></i> –í—Å–µ –≤–∏–¥–µ–æ
        </a>
      </div>
    </section>
  </main>

  <!-- JS ‚Äî –í–ï–°–¨ –§–£–ù–ö–¶–ò–û–ù–ê–õ -->
  <script>
    // ========================================
    // –ö–û–ù–§–ò–ì
    // ========================================
    const CONFIG = {
      rutube: {
        personId: '1097477',
        baseUrl: 'https://rutube.ru/api/video/person',
        embed: function(id) { return `https://rutube.ru/play/embed/${id}?platform=mortisplay`; }
      },
      youtube: {
        channelId: 'UCXXXXXXXXXXXXXXXXXXXXXX',
        apiKey: 'AIzaSyBxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
        embed: function(id) { return `https://www.youtube-nocookie.com/embed/${id}?rel=0`; }
      }
    };

    // ========================================
    // –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    // ========================================
    let currentPlatform = localStorage.getItem('videoPlatform') || 'rutube';
    let currentPage = 1;
    let currentFilter = 'all';
    let allVideos = [];
    let filteredVideos = [];
    let nextPageToken = '';

    const platformSwitch = document.getElementById('platformSwitch');
    const videosGrid = document.getElementById('videosGrid');
    const loadMoreBtn = document.getElementById('loadMoreVideos');
    const allVideosLink = document.getElementById('allVideosLink');
    const switchLoader = document.getElementById('switchLoader');

    // ========================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ========================================
    platformSwitch.value = currentPlatform;
    updateAllVideosLink();
    fetchVideos();
    setupPlatformSwitch();
    setupFilters();

    // ========================================
    // –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨
    // ========================================
    function setupPlatformSwitch() {
      platformSwitch.addEventListener('change', function() {
        currentPlatform = platformSwitch.value;
        localStorage.setItem('videoPlatform', currentPlatform);
        currentPage = 1;
        nextPageToken = '';
        switchLoader.classList.remove('hidden');
        videosGrid.innerHTML = '';
        allVideos = [];
        fetchVideos();
        updateAllVideosLink();
        showNotification('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ' + (currentPlatform === 'rutube' ? 'Rutube' : 'YouTube') + '!');
      });
    }

    function updateAllVideosLink() {
      if (currentPlatform === 'rutube') {
        allVideosLink.href = 'https://rutube.ru/channel/1097477/videos/';
        allVideosLink.innerHTML = '<i class="fa-brands fa-rutube"></i> –í—Å–µ –≤–∏–¥–µ–æ';
      } else {
        allVideosLink.href = 'https://www.youtube.com/@MortisPlay/videos';
        allVideosLink.innerHTML = '<i class="fa-brands fa-youtube"></i> –í—Å–µ –≤–∏–¥–µ–æ';
      }
    }

    // ========================================
    // –ó–ê–ì–†–£–ó–ö–ê
    // ========================================
    async function fetchVideos(append = false) {
      if (!append) {
        videosGrid.innerHTML = '<div class="col-span-full text-center py-10"><i class="fa-solid fa-spinner animate-spin text-5xl text-purple-400"></i></div>';
      }

      try {
        let videos = [];

        if (currentPlatform === 'rutube') {
          const res = await fetch(`${CONFIG.rutube.baseUrl}/${CONFIG.rutube.personId}?sort=created_ts_desc&page=${currentPage}&page_size=12`);
          const data = await res.json();
          videos = data.results.map(v => ({
            id: v.id,
            title: v.title,
            thumbnail: v.thumbnail_url,
            duration: formatDuration(v.duration),
            category: guessCategory(v.title),
            url: CONFIG.rutube.embed(v.id)
          }));
        } else {
          const token = append ? nextPageToken : '';
          const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${CONFIG.youtube.channelId}&maxResults=12&pageToken=${token}&order=date&key=${CONFIG.youtube.apiKey}`);
          const data = await res.json();
          nextPageToken = data.nextPageToken || '';
          videos = data.items
            .filter(i => i.id.kind === 'youtube#video')
            .map(i => ({
              id: i.id.videoId,
              title: i.snippet.title,
              thumbnail: i.snippet.thumbnails.high.url,
              duration: '??',
              category: guessCategory(i.snippet.title),
              url: CONFIG.youtube.embed(i.id.videoId)
            }));
        }

        allVideos = append ? [...allVideos, ...videos] : videos;
        filterVideos();
        renderVideos(append);

      } catch (e) {
        videosGrid.innerHTML = `<p class="col-span-full text-center text-red-400 py-10">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ üò¢ –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ!</p>`;
        console.error(e);
      } finally {
        switchLoader.classList.add('hidden');
      }
    }

    // ========================================
    // –†–ï–ù–î–ï–†
    // ========================================
    function renderVideos(append = false) {
      if (!append) videosGrid.innerHTML = '';

      const start = (currentPage - 1) * 12;
      const toShow = filteredVideos.slice(start, start + 12);

      toShow.forEach(v => {
        const card = document.createElement('div');
        card.className = 'video-card glass-card p-4 opacity-0 translate-y-4 transition-all duration-500';
        card.dataset.category = v.category;
        card.innerHTML = `
          <div class="relative aspect-video rounded-xl overflow-hidden ring-1 ring-purple-500/30 shadow-lg">
            <iframe src="${v.url}" loading="lazy" allowfullscreen class="w-full h-full" title="${v.title}"></iframe>
            <div class="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-2 py-1 rounded font-mono">${v.duration}</div>
          </div>
          <p class="mt-3 text-sm text-gray-300 line-clamp-2 font-medium">${v.title}</p>
        `;

        const iframe = card.querySelector('iframe');
        iframe.onload = () => card.classList.remove('opacity-0', 'translate-y-4');

        videosGrid.appendChild(card);
      });

      loadMoreBtn.style.display = allVideos.length >= filteredVideos.length ? 'none' : 'inline-flex';
    }

    // ========================================
    // –§–ò–õ–¨–¢–†–´
    // ========================================
    function setupFilters() {
      document.querySelectorAll('.video-filter').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.video-filter').forEach(b => b.classList.toggle('active', b === btn));
          currentFilter = btn.dataset.filter;
          currentPage = 1;
          filterVideos();
          renderVideos();
        });
      });
    }

    function filterVideos() {
      filteredVideos = currentFilter === 'all' ? allVideos : allVideos.filter(v => v.category === currentFilter);
    }

    // ========================================
    // –£–¢–ò–õ–ò–¢–´
    // ========================================
    loadMoreBtn.addEventListener('click', () => {
      currentPage++;
      fetchVideos(true);
    });

    function guessCategory(title) {
      title = title.toLowerCase();
      if (title.includes('—Å—Ç—Ä–∏–º') || title.includes('live')) return 'streams';
      if (title.includes('—É–≥–∞—Ä') || title.includes('–º–µ–º') || title.includes('–ø—Ä–∏–∫–æ–ª')) return 'fun';
      if (title.includes('–±–ª–∏—Ü') || title.includes('blitz')) return 'blitz';
      return 'fun';
    }

    function formatDuration(sec) {
      if (!sec) return '??:??';
      const m = String(Math.floor(sec / 60)).padStart(2, '0');
      const s = String(sec % 60).padStart(2, '0');
      return `${m}:${s}`;
    }

    function showNotification(msg) {
      const notif = document.createElement('div');
      notif.className = 'fixed bottom-4 right-4 glass-card p-4 text-sm neon-btn z-50 animate-pulse';
      notif.textContent = msg;
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 3000);
    }
  </script>
</body>
</html>
