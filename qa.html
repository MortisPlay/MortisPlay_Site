<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Mortis Play ‚Äî Q&A</title>
<link rel="icon" href="/images/favicon.ico" />
<script src="https://cdn.tailwindcss.com" defer></script>
<script src="https://kit.fontawesome.com/b48beda69e.js" crossorigin="anonymous" defer></script>
<style>
.glass-button { 
  background: rgba(255, 255, 255, 0.15); 
  backdrop-filter: blur(10px); 
  border: 1px solid rgba(255, 255, 255, 0.3); 
  border-radius: 0.75rem; 
  padding: 0.75rem 1.5rem; 
  color: #fff; 
  font-weight: 600; 
  transition: all 0.3s ease; 
}
.glass-button:hover { 
  background: rgba(255, 255, 255, 0.25); 
  transform: scale(1.05); 
}
.dark .glass-button { 
  background: rgba(50, 50, 50, 0.15); 
  border-color: rgba(200, 200, 200, 0.2); 
}
.fade-in { 
  opacity: 0; 
  transform: translateY(16px); 
  transition: opacity 0.6s ease, transform 0.6s ease; 
}
.fade-in.is-visible { 
  opacity: 1; 
  transform: none; 
}
.question-slide { 
  animation: slideIn 0.5s ease-out; 
}
@keyframes slideIn {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.blink { 
  animation: blink 1s step-end infinite; 
}
@keyframes blink {
  50% { opacity: 0; }
}
@media (max-width: 640px) { 
  .glass-button { 
    padding: 0.5rem 1rem; 
    font-size: 0.9rem; 
  } 
}
.success-message { color: #10b981; }
.error-message { color: #ef4444; }
textarea, input {
  color: #333; 
}
.dark textarea, .dark input {
  color: #d1d5db; 
}
textarea:focus, input:focus {
  outline: none;
  border-color: #3b82f6; 
}
.dark textarea:focus, .dark input:focus {
  border-color: #60a5fa; 
}
.notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 10px 20px;
  border-radius: 5px;
  z-index: 1000;
  display: none;
}
</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-orange-50 via-white to-indigo-50 dark:from-slate-900 dark:via-slate-900 dark:to-indigo-950 text-slate-800 dark:text-slate-100">
<div class="mx-auto max-w-7xl px-4 py-16">
<h1 class="text-3xl font-bold text-center text-slate-900 dark:text-white">Q&A —Å Mortis Play</h1>
<p class="mt-4 text-center text-slate-600 dark:text-slate-300">–ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ª—É—á—à–∏–µ –ø–æ–ø–∞–¥—É—Ç –≤ —Ä–∞–∑–¥–µ–ª –ø–æ—Å–ª–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏!</p>

<!-- –§–æ—Ä–º–∞ -->
<div class="mt-8 max-w-lg mx-auto fade-in" id="qaFormContainer">
<form id="qaForm">
    <input type="text" name="nickname" id="nicknameInput" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º" required class="w-full p-2 mb-2 border rounded bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200">
    <textarea name="question" id="questionInput" placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å" required class="w-full p-2 mb-2 border rounded bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200"></textarea>
    <button type="submit" class="glass-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="questionLimit" class="mt-2 text-center text-sm text-slate-600 dark:text-slate-300"><span id="timer">00:00:00</span></div>
    <div id="submitStatus" class="mt-2 text-center"></div>
    <button type="button" id="toggleTheme" class="glass-button mt-2">üåô</button>
</form>
</div>

<!-- –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
<div id="moderationPanel" class="mt-8 max-w-lg mx-auto fade-in hidden">
<h2 class="text-xl font-semibold text-center text-slate-900 dark:text-white">–ú–æ–¥–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ <span id="pendingCount" class="blink text-red-500"></span></h2>
<ul id="pendingQuestions" class="mt-4 space-y-2"></ul>
<button id="clearApproved" class="glass-button mt-4 w-full">–û—á–∏—Å—Ç–∏—Ç—å –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ</button>
</div>

<!-- –°–ø–∏—Å–æ–∫ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ -->
<div id="qaList" class="mt-12 space-y-4 fade-in"></div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div id="userNotification" class="notification"></div>
</div>

<script>
const isDevMode = new URLSearchParams(window.location.search).get('dev') === 'true';
if (isDevMode) document.getElementById('moderationPanel').style.display = 'block';

// –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
let questions = JSON.parse(localStorage.getItem('qaQuestions')) || [];
const dailyLimit = 5;
const blackList = ['–º–∞—Ç', '–æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ', '—Å–ø–∞–º', '–±–æ—Ç', '—á—ë—Ä—Ç', '–¥—É—Ä–∞–∫']; // –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤

// –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
const questionLimit = document.getElementById('questionLimit');
const pendingCount = document.getElementById('pendingCount');
const userNotification = document.getElementById('userNotification');
const timerElement = document.getElementById('timer');
const toggleTheme = document.getElementById('toggleTheme');

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
if (toggleTheme) {
    toggleTheme.addEventListener('click', () => {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        toggleTheme.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
    });
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark');
        toggleTheme.textContent = '‚òÄÔ∏è';
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∏ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
function validateInput(nickname, question) {
    if (nickname.length < 3 || nickname.length > 20) return '–ù–∏–∫–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤!';
    if (question.length < 10 || question.length > 200) return '–í–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 10 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤!';
    if (blackList.some(word => nickname.toLowerCase().includes(word) || question.toLowerCase().includes(word))) {
        return '–°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Å–ª–æ–≤–∞!';
    }
    return null;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ –∏ —Ç–∞–π–º–µ—Ä —Å–±—Ä–æ—Å–∞
function checkDailyLimit() {
    const today = new Date().toLocaleDateString();
    const dailyStats = JSON.parse(localStorage.getItem('qaDailyStats')) || {};
    const todayCount = dailyStats[today] || 0;
    const remaining = dailyLimit - todayCount;
    questionLimit.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${remaining} –∏–∑ ${dailyLimit} `;

    // –¢–∞–π–º–µ—Ä —Å–±—Ä–æ—Å–∞
    const now = new Date();
    const endOfDay = new Date(now);
    endOfDay.setHours(23, 59, 59, 999);
    const timeLeft = Math.floor((endOfDay - now) / 1000); // –í —Å–µ–∫—É–Ω–¥–∞—Ö
    if (todayCount >= dailyLimit) {
        questionLimit.innerHTML = `–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ ${dailyLimit} –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞ –¥–µ–Ω—å! –°–±—Ä–æ—Å —á–µ—Ä–µ–∑: <span id="timer">${timerElement.textContent}</span>`;
    }
    updateTimer(timeLeft);

    return todayCount >= dailyLimit ? `–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ ${dailyLimit} –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞ –¥–µ–Ω—å!` : null;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
function updateTimer(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    timerElement.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    if (seconds > 0) setTimeout(() => updateTimer(seconds - 1), 1000);
}

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
function showNotification(message, isSuccess = true) {
    userNotification.textContent = message;
    userNotification.className = 'notification ' + (isSuccess ? 'bg-green-600' : 'bg-red-600');
    userNotification.style.display = 'block';
    setTimeout(() => userNotification.style.display = 'none', 3000);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
document.getElementById('qaForm')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const form = e.target;
    const nickname = document.getElementById('nicknameInput').value.trim();
    const question = document.getElementById('questionInput').value.trim();
    const date = new Date().toLocaleString('ru-RU');
    const submitStatus = document.getElementById('submitStatus');

    const validationError = validateInput(nickname, question);
    if (validationError) {
        submitStatus.textContent = validationError;
        submitStatus.classList.add('error-message');
        return;
    }

    const limitError = checkDailyLimit();
    if (limitError) {
        submitStatus.innerHTML = limitError;
        submitStatus.classList.add('error-message');
        return;
    }

    submitStatus.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
    submitStatus.classList.remove('success-message', 'error-message');

    const newQuestion = { nickname, text: question, date, approved: false };
    questions.push(newQuestion);
    localStorage.setItem('qaQuestions', JSON.stringify(questions));

    submitStatus.textContent = '–í–æ–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!';
    submitStatus.classList.add('success-message');
    form.reset();

    addQuestionToList(newQuestion.nickname, newQuestion.text, newQuestion.date);
    if (isDevMode) updatePendingQuestions();
});

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –≤ —Å–ø–∏—Å–æ–∫ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
function addQuestionToList(nickname, question, date) {
    const qaList = document.getElementById('qaList');
    const div = document.createElement('div');
    div.className = 'p-4 bg-white dark:bg-slate-800 rounded-lg shadow question-slide';
    div.innerHTML = `<p class="question-text">${nickname}: ${question} <span class="text-xs text-slate-500 dark:text-slate-400">(${new Date(date).toLocaleString('ru-RU')})</span></p>`;
    qaList.insertBefore(div, qaList.firstChild);
    setTimeout(() => div.classList.add('is-visible'), 10);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
function updateQAList() {
    const qaList = document.getElementById('qaList');
    qaList.innerHTML = '';
    const approvedQuestions = questions.filter(q => q.approved);
    if (approvedQuestions.length > 0) {
        approvedQuestions.forEach(q => {
            const div = document.createElement('div');
            div.className = 'p-4 bg-white dark:bg-slate-800 rounded-lg shadow question-slide';
            div.innerHTML = `<p class="question-text">${q.nickname}: ${q.text} <span class="text-xs text-slate-500 dark:text-slate-400">(${new Date(q.date).toLocaleString('ru-RU')})</span></p>`;
            qaList.appendChild(div);
            setTimeout(() => div.classList.add('is-visible'), 10);
        });
    } else {
        qaList.innerHTML = '<p class="text-center text-slate-600 dark:text-slate-300">–ü–æ–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ—Ç ‚Äî –∂–¥—ë–º –º–æ–¥–µ—Ä–∞—Ü–∏—é!</p>';
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–∂–∏–¥–∞—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —Å—á—ë—Ç—á–∏–∫–∞
function updatePendingQuestions() {
    if (!isDevMode) return;
    const pendingList = document.getElementById('pendingQuestions');
    pendingList.innerHTML = '';
    const pendingQuestions = questions.filter(q => !q.approved);
    pendingCount.textContent = pendingQuestions.length > 0 ? `(–û–∂–∏–¥–∞–µ—Ç: ${pendingQuestions.length})` : '';
    if (pendingQuestions.length > 0) {
        pendingQuestions.forEach((q, index) => {
            const li = document.createElement('li');
            li.className = 'p-2 bg-gray-100 dark:bg-gray-700 rounded';
            li.innerHTML = `<div class="flex justify-between items-center">
                <span class="question-text">${q.nickname}: ${q.text} <span class="text-xs text-slate-500 dark:text-slate-400">(${new Date(q.date).toLocaleString('ru-RU')})</span></span>
                <div>
                    <button class="glass-button text-xs px-2 py-1 mr-2" onclick="approveQuestion(${index})">–û–¥–æ–±—Ä–∏—Ç—å</button>
                    <button class="glass-button text-xs px-2 py-1" onclick="rejectQuestion(${index})">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                </div>
            </div>`;
            pendingList.appendChild(li);
        });
    } else {
        pendingList.innerHTML = '<p class="text-center text-slate-600 dark:text-slate-300">–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –æ–¥–æ–±—Ä–µ–Ω—ã –∏–ª–∏ –µ—â—ë –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.</p>';
    }
}

// –û–¥–æ–±—Ä–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
function approveQuestion(index) {
    questions[index].approved = true;
    localStorage.setItem('qaQuestions', JSON.stringify(questions));
    updateQAList();
    updatePendingQuestions();
    showNotification(`–í–∞—à –≤–æ–ø—Ä–æ—Å "${questions[index].text}" –æ–¥–æ–±—Ä–µ–Ω!`, true);
}

// –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
function rejectQuestion(index) {
    const rejectedQuestion = questions[index].text;
    questions.splice(index, 1);
    localStorage.setItem('qaQuestions', JSON.stringify(questions));
    updatePendingQuestions();
    showNotification(`–í–∞—à –≤–æ–ø—Ä–æ—Å "${rejectedQuestion}" –æ—Ç–∫–ª–æ–Ω—ë–Ω.`, false);
}

// –û—á–∏—Å—Ç–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
document.getElementById('clearApproved')?.addEventListener('click', () => {
    questions = questions.filter(q => !q.approved);
    localStorage.setItem('qaQuestions', JSON.stringify(questions));
    updateQAList();
    updatePendingQuestions();
});

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
const io = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('is-visible'); });
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(el => io.observe(el));

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
checkDailyLimit(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ –∏ —Ç–∞–π–º–µ—Ä
updateQAList();
if (isDevMode) updatePendingQuestions();
</script>
</body>
</html>
